<% content_for :title, "Projects" %>

<div class="container mx-auto px-4 py-6">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-semibold text-white">Projects</h1>
    <%= link_to "Add project", new_project_path, class: "inline-flex items-center px-4 py-2 rounded-xl bg-purple-950 hover:bg-purple-900 text-white border border-white/10" %>
  </div>

  <div class="mb-4 rounded-lg border border-white/10 bg-white/5 p-3">
    <%= form_with url: projects_path, method: :get, local: true do %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
        <div>
          <label class="block mb-1 text-white/80 text-sm">Name</label>
          <%= text_field_tag :name, params[:name], placeholder: "Search by name", class: "w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 placeholder-white/60 text-white focus:outline-none focus:ring-2 focus:ring-fuchsia-400 focus:border-transparent" %>
        </div>
        <div>
          <label class="block mb-1 text-white/80 text-sm">Status</label>
          <% statuses = [["New","new"],["In progress","in_progress"],["Waiting for approval","waiting_for_approval"],["Done","done"]] %>
          <%= select_tag :status, options_for_select([["Any status",""]] + statuses, params[:status]), class: "w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-fuchsia-400 focus:border-transparent" %>
        </div>
        <div>
          <label class="block mb-1 text-white/80 text-sm">Designers</label>
          <%= select_tag "designer_ids[]",
                options_from_collection_for_select(@filter_designers, :id, :name, Array(params[:designer_ids])),
                multiple: true,
                class: "w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-fuchsia-400 focus:border-transparent",
                size: 4 %>
        </div>
        <div>
          <label class="block mb-1 text-white/80 text-sm">Clients</label>
          <%= select_tag "client_ids[]",
                options_from_collection_for_select(@filter_clients, :id, :name, Array(params[:client_ids])),
                multiple: true,
                class: "w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-fuchsia-400 focus:border-transparent",
                size: 4 %>
        </div>
      </div>
      <div class="mt-3 flex items-center gap-2">
        <%= submit_tag "Filter", class: "inline-flex items-center px-4 py-2 rounded-xl bg-purple-950 hover:bg-purple-900 text-white border border-white/10" %>
        <%= link_to "Reset", projects_path, class: "inline-flex items-center px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 text-white border border-white/10" %>
      </div>
    <% end %>
  </div>

  <% if @projects.any? %>
    <div class="space-y-3">
      <% @projects.each do |project| %>
        <%= link_to project_path(project), class: "block rounded-lg border border-white/10 bg-white/5 p-3 overflow-hidden hover:bg-white/10 transition-colors" do %>
          <div class="flex items-start justify-between gap-2">
            <div class="flex-1 min-w-0">
              <div class="text-white text-sm font-medium break-words"><%= project.name %></div>
              <% status_label =
                case project.status.to_s
                when "new" then "New"
                when "in_progress", "in_progess" then "In progress"
                when "waiting_for_approval" then "Waiting for approval"
                when "done" then "Done"
                else project.status.to_s.humanize
                end %>
              <% status_bg =
                case project.status.to_s
                when "new" then "#38bdf8" # sky-400
                when "in_progress", "in_progess" then "#f59e0b" # amber-500
                when "waiting_for_approval" then "#f97316" # orange-500
                when "done" then "#10b981" # emerald-500
                else "#94a3b8" # slate-400
                end %>
              <div class="mt-1">
                <span class="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium border border-white/10" style="background-color: <%= status_bg %>; color: #ffffff;"><%= status_label %></span>
              </div>
            </div>
            <div class="text-right w-48 shrink-0">
              <div>
                <div class="text-white/70 text-xs uppercase tracking-wide mb-1">Designers</div>
                <% if project.designers.any? %>
                  <div class="flex flex-wrap gap-1 justify-end">
                    <% project.designers.each do |designer| %>
                      <span class="inline-flex items-center rounded-md bg-white/10 border border-white/10 px-2 py-0.5 text-xs text-white/90"><%= designer.name %></span>
                    <% end %>
                  </div>
                <% else %>
                  <div class="text-white/60 text-xs">None</div>
                <% end %>
              </div>
              <div class="mt-2">
                <div class="text-white/70 text-xs uppercase tracking-wide mb-1">Clients</div>
                <% if project.clients.any? %>
                  <div class="flex flex-wrap gap-1 justify-end">
                    <% project.clients.each do |client| %>
                      <span class="inline-flex items-center rounded-md bg-white/10 border border-white/10 px-2 py-0.5 text-xs text-white/90"><%= client.name %></span>
                    <% end %>
                  </div>
                <% else %>
                  <div class="text-white/60 text-xs">None</div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <div class="text-white/80">No projects yet.</div>
  <% end %>
</div>

